<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>R√©conciliation des Actes M√©dicaux - Dr Pablo NEEL</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px;min-height:100vh}
    .container{max-width:1400px;margin:0 auto;background:#fff;border-radius:15px;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden}
    .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:30px;text-align:center}
    .header h1{font-size:2em;margin-bottom:10px}
    .content{padding:30px}
    .upload-section{background:#f8f9fa;border-radius:10px;padding:25px;margin-bottom:30px}
    .upload-section h2{color:#667eea;margin-bottom:20px;font-size:1.5em}
    .file-input-group{margin-bottom:20px}
    .file-input-group label{display:block;font-weight:600;color:#333;margin-bottom:8px;font-size:1.05em}
    .file-input-button{display:block;padding:12px 20px;background:#fff;border:2px dashed #667eea;border-radius:8px;color:#667eea;font-weight:600;cursor:pointer;transition:.3s;text-align:center}
    .file-input-button:hover{background:#667eea;color:#fff}
    .files-list{margin-top:15px}
    .file-item{display:flex;align-items:center;justify-content:space-between;padding:10px 15px;background:#e8eaf6;border-radius:5px;margin-bottom:8px;transition:.3s}
    .file-item:hover{background:#d1d4e8}
    .file-info{display:flex;align-items:center;gap:10px;flex:1}
    .file-name{font-weight:600;color:#5e35b1}
    .file-size{font-size:.85em;color:#666}
    .remove-file-btn{padding:6px 12px;background:#f44336;color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:.9em;transition:.3s}
    .remove-file-btn:hover{background:#d32f2f;transform:scale(1.05)}
    .monthly-summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-bottom:30px}
    .month-card{background:#fff;border-radius:10px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,.1);border-left:5px solid #667eea}
    .month-card h3{color:#667eea;margin-bottom:15px;font-size:1.3em}
    .btn{padding:12px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:.3s}
    .btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,.4)}
    .btn-secondary{background:#6c757d;color:#fff}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üè• R√©conciliation des Actes M√©dicaux</h1>
      <p>Analyse, saisie manuelle et comparaison quotidienne</p>
    </div>

    <div class="content">
      <div class="upload-section">
        <h2>üìÅ Chargement des fichiers</h2>
        <p>Ajoutez vos fichiers d‚Äôactes (.xlsx) et d‚Äôhonoraires (.csv)</p>
        <div class="file-input-group">
          <button class="file-input-button" onclick="document.getElementById('actesFile').click()">üìä Ajouter fichier Excel</button>
          <input type="file" id="actesFile" accept=".xlsx,.xls" multiple style="display:none" />
          <div id="actesFilesList" class="files-list"></div>
        </div>

        <div class="file-input-group">
          <button class="file-input-button" onclick="document.getElementById('honorairesFiles').click()">üí∞ Ajouter fichier CSV</button>
          <input type="file" id="honorairesFiles" accept=".csv" multiple style="display:none" />
          <div id="honorairesFilesList" class="files-list"></div>
        </div>

        <div class="action-buttons">
          <button class="btn btn-primary" id="analyzeBtn" disabled>üîç Analyser</button>
          <button class="btn btn-secondary" id="resetBtn">üîÑ R√©initialiser</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase Core -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-analytics.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDcP7Cuvbkvmcr_mq7E_nHuxjSmDWK08-4",
      authDomain: "reconciliateur-50684.firebaseapp.com",
      projectId: "reconciliateur-50684",
      storageBucket: "reconciliateur-50684.firebasestorage.app",
      messagingSenderId: "1029928449677",
      appId: "1:1029928449677:web:7445402f84a963d3ab54c4",
      measurementId: "G-STE125RQPZ"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
  </script>

  <!-- Authentification Google -->
  <script type="module">
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } 
    from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

    import { getFirestore, doc, setDoc, getDoc } 
    from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    const db = getFirestore(app);

    const loginBtn = document.createElement("button");
    loginBtn.textContent = "üîê Se connecter avec Google";
    loginBtn.className = "btn btn-primary";
    loginBtn.style.margin = "20px";
    document.body.prepend(loginBtn);

    const logoutBtn = document.createElement("button");
    logoutBtn.textContent = "üö™ Se d√©connecter";
    logoutBtn.className = "btn btn-secondary";
    logoutBtn.style.margin = "20px";
    logoutBtn.style.display = "none";
    document.body.prepend(logoutBtn);

    let currentUser = null;

    loginBtn.addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        currentUser = result.user;
        alert(`‚úÖ Connect√© : ${currentUser.displayName}`);
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
      } catch (error) {
        alert("Erreur de connexion : " + error.message);
      }
    });

    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      alert("D√©connect√© !");
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        console.log("Utilisateur connect√© :", user.email);
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
      } else {
        currentUser = null;
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
      }
    });
  </script>
</body>
</html>
